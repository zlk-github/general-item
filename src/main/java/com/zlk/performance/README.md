##  性能

### 1 系统吞度量

系统吞吐量几个重要參数：QPS、并发数、响应时间

    QPS：每秒钟request/事务 数量
    
    并发数： 系统同一时候处理的request/事务数
    
    响应时间：  一般取平均响应时间


#### 1.1 QPS(Queries Per Second)

每秒查询率QPS,是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。即为每秒的响应请求数，也叫做最大吞吐量。

    QPS(TPS) = 并发量 / 平均响应时间
    并发量 = QPS * 平均响应时间

#### 1.2 TPS（每秒事务处理量(TransactionPerSecond)）

一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。
客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数

过程包括：
  
    客户端请求服务端
    服务端内部处理
    服务端返回客户端

    Qps基本类似于Tps，但是不同的是，对于一个页面的一次访问，形成一个Tps；
    但一次页面请求，可能产生多次对服务器的请求，服务器对这些请求，就可计入“Qps”之中
    
    例：访问一个页面会请求服务器3次，一次放，产生一个“T”，产生3个“Q”

    例如：一个大胃王一秒能吃10个包子，一个人0.1秒能吃1个包子，那么他们是不是一样的呢？答案是否定的，
         因为这个人不可能在一秒钟吃下10个包子，她可能要吃很久。这个时候这个大胃王就相当于TPS，而这个人则是QPS。虽然很相似，但其实是不同的。


总结：TPS代表总的响应能力，QPS更多体现单机的极限能力。

#### 1.3 并发数

系统同时能处理的请求数量，反应系统的负债能力。可以分析机器1S内访问日志数量得到。



#### 1.4 吞吐量

吞吐量是系统在单位时间内处理请求的数量。TPS与QPS都是吞吐量的量化指标。



#### 1.5 吞吐量要素


单个请求对CPU的消耗高，外部接口的响应慢，内存的消耗高，IO响应慢，频繁上下文切换，负荷过重等等都会影响吞吐量。相反则吞吐能力越高。


#### 2 QPS评估重要参数


PV（Page View）：页面访问量（点击量），可以统计服务一天的访问日志得到。

UV（Unique Visitor:独立访客，可统计一天内访问某站点的用户数。可以统计服务一天的访问日志并根据用户的唯一标识去重得到。

响应时间（RT）：响应时间是指系统对请求作出响应的时间，一般取平均响应时间。可以通过Nginx、Apache之类的Web Server得到。

DAU(Daily Active User)：日活用户数量。统计一日内去重登录用户。

MAU(Month Active User)：月活跃用户数量，指网站、app等去重后的月活跃用户数量（每天的用户去重，然后30天（一个月）的相加）。


#### 3 系统吞吐量评估

#### 3.1 压测出系统的TPS

考虑点：架构设计，数据库，IO,线程，中间件等。


#### 3.2 估算所需服务器

找出系统的最高TPS和日PV，这两个要素有相对比较稳定的关系（除了放假、季节性因素影响之外）。


........未完待续


#### 补充

我们站在管理员的角度考虑需要关注的性能点。

    1、 响应时间
    2、 服务器资源使用情况是否合理
    3、 应用服务器和数据库资源使用是否合理
    4、 系统能否实现扩展
    5、 系统最多支持多少用户访问、系统最大业务处理量是多少
    6、 系统性能可能存在的瓶颈在哪里
    7、 更换那些设备可以提高性能
    8、 系统能否支持7×24小时的业务访问

再次，站在开发（设计）人员角度去考虑。

    1、 架构设计是否合理
    2、 数据库设计是否合理
    3、 代码是否存在性能方面的问题
    4、 系统中是否有不合理的内存使用方式
    5、 系统中是否存在不合理的线程同步方式
    6、 系统中是否存在不合理的资源竞争



### 参考

    https://mp.weixin.qq.com/s/vwvllCFZ3DyNtBmY9h1ZEA

